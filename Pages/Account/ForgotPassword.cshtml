@page
@model ComputerStore.Pages.Account.ForgotPasswordModel
@{
    ViewData["Title"] = "Recuperar Contraseña";
}

<div class="container mt-5">
  <div class="row justify-content-center">
<div class="col-lg-6 col-md-8">
            <div class="card shadow-lg border-0 rounded-4">
            <div class="card-header bg-primary text-white text-center py-4 rounded-top-4">
            <h2 class="mb-0">
      <i class="fas fa-key me-2"></i>
      Recuperar Contraseña
</h2>
       <p class="mb-0 mt-2 opacity-75">Te enviaremos un código de verificación</p>
      </div>
     <div class="card-body p-5">
    @if (!string.IsNullOrEmpty(TempData["ErrorMessage"]?.ToString()))
  {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
       <i class="fas fa-exclamation-circle me-2"></i>
     <strong>Error:</strong> @TempData["ErrorMessage"]
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
 }
       
       @if (Model.CodeSent)
  {
   @if (string.IsNullOrEmpty(TempData["ErrorMessage"]?.ToString()))
  {
       <div class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="fas fa-check-circle me-2"></i>
       <strong>¡Código enviado!</strong> Revisa tu correo electrónico.
 <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
         </div>
 }
 
   <form method="post" asp-page-handler="VerifyCode">
     <input type="hidden" asp-for="Input.Email" />
     
   <div class="mb-4">
      <label class="form-label fw-bold">
        <i class="fas fa-shield-alt text-primary me-1"></i>Código de Verificación
    </label>
   <input name="verificationCode" id="verificationCode" class="form-control form-control-lg text-center" 
          placeholder="Ingresa el código de 6 dígitos" maxlength="6" 
    style="letter-spacing: 10px; font-size: 24px;" />
       <div asp-validation-summary="ModelOnly" class="text-danger small mt-2"></div>
 <small class="text-muted d-block mt-2">
    <i class="fas fa-clock me-1"></i>El código expira en 15 minutos
</small>
   </div>

    <div class="d-grid mb-3">
        <button type="submit" class="btn btn-primary btn-lg">
 <i class="fas fa-check me-2"></i>Verificar Código
   </button>
      </div>

    <div class="text-center">
      <button type="submit" asp-page-handler="ResendCode" class="btn btn-link text-decoration-none">
  <i class="fas fa-redo me-1"></i>Reenviar código
 </button>
        </div>
 </form>
  }
           else
          {
       <p class="text-muted mb-4">
   Ingresa tu correo electrónico y te enviaremos un código de verificación 
     para restablecer tu contraseña.
       </p>

          <form method="post">
  <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
    
  <div class="mb-4">
       <label asp-for="Input.Email" class="form-label fw-bold">
           <i class="fas fa-envelope text-primary me-1"></i>Correo Electrónico
        </label>
      <input asp-for="Input.Email" class="form-control form-control-lg" 
                placeholder="tu@email.com" autocomplete="email" />
     <span asp-validation-for="Input.Email" class="text-danger small"></span>
    </div>

    <div class="d-grid mb-4">
       <button type="submit" class="btn btn-primary btn-lg" id="sendCodeButton">
    <i class="fas fa-paper-plane me-2"></i>Enviar Código
          </button>
  </div>

      <div class="text-center">
      <a class="text-decoration-none" asp-page="./Login">
          <i class="fas fa-arrow-left me-1"></i>Volver al inicio de sesión
            </a>
       </div>
    </form>
    }
      </div>
       </div>

  <!-- Información de ayuda -->
     @if (!Model.CodeSent)
  {
     <div class="card bg-light border-0 mt-4">
       <div class="card-body p-4">
            <h6 class="text-primary mb-3">
  <i class="fas fa-info-circle me-2"></i>¿Necesitas ayuda?
   </h6>
       <ul class="small text-muted mb-0">
  <li>Asegúrate de ingresar el correo electrónico con el que te registraste</li>
              <li>Revisa tu carpeta de spam si no recibes el código</li>
 <li>El código de verificación expira en 15 minutos</li>
             <li>Si tienes problemas, contáctanos en soporte@computerhipermegared.com</li>
   </ul>
       </div>
      </div>
            }
  </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
   @if (Model.CodeSent)
            {
     <text>
     const codeInput = document.getElementById('verificationCode'); // Corregido el ID
        if (codeInput) {
      codeInput.focus();
      
    // Solo permitir números
       codeInput.addEventListener('input', function(e) {
 this.value = this.value.replace(/[^0-9]/g, '');
    });
            }
 </text>
  }
     else
  {
 <text>
     const emailInput = document.getElementById('Input_Email');
  if (emailInput && !emailInput.value) {
      emailInput.focus();
        }
   
         const sendButton = document.getElementById('sendCodeButton');
    const form = emailInput?.closest('form');
     if (form && sendButton) {
    form.addEventListener('submit', function() {
      sendButton.disabled = true;
   sendButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Enviando...';
  });
            }
      </text>
      }
   });
    </script>

    <style>
   .card {
       transition: transform 0.3s ease;
  }
 
.card:hover {
   transform: translateY(-5px);
        }
        
     .form-control:focus {
            border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
     
     .btn-primary {
   background: linear-gradient(135deg, #0d6efd, #0b5ed7);
         border: none;
  }

   .btn-primary:hover {
       background: linear-gradient(135deg, #0b5ed7, #0a58ca);
        }
    </style>
}
